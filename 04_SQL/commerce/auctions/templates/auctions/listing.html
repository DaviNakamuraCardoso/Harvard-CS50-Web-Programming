{% extends "auctions/layout.html" %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'auctions/auction.css' %}">
{% endblock %}
{% block body %}

{% if message %}
<div class="alert alert-danger">
    {{ message }}
</div>
{% endif %}

{% if listing.is_closed %}
    {% if listing.winner == request.user.username %}
    <div class="alert alert-success">
        Congratulations, <em>{{ request.user.username }}</em>! You won this auction!
    </div>
    {% endif %}
    <h1>This listing is closed.</h1>
    <h2>Winner: {{ listing.winner }}</h2>



{% endif %}
<div class="listing-container">
    <div class="listing-card">
        <div class="head">

        </div>
        <div class="product">
            {% if listing.image_url %}
                <img src="{{listing.image_url}}" width=200px height=auto>
            {% else %}
                <img src="{% static 'auctions/images/default.jpg'%}">
            {% endif %} 

        </div>
        <div class="text">
            <div class="title">
                <h3>{{ listing.title }}</h3>
                <p>{{ listing.description }}</p>
            </div>

        </div>
        <div class="footer">

            <!-- Make bids -->
            <div class="action">
                {% if request.user.username == listing.user.username %}


                {% elif not listing.is_closed  %}
                    {% if user_bid is None %}
                    <form action="{% url 'listing' listing.id %}" method="post">
                        {% csrf_token %}
                        <input class="text-box" type="number" name="add_bid" min="{{listing.current_bid}}">
                        <input class="bid-btn" type="submit" value="Make Bid">
                    
                    </form>
                    {% else %}
                        <form action="{% url 'listing' listing.id %}" method="post">
                            {% csrf_token %}
                        
                            <input class="text-box" type="number" name="updated_bid" placeholder="{{bid.bid}}" min="{{bid.bid}}">
                            <input class="bid-btn" type="submit" value="Update Bid">
                        
                        </form>



                    {% endif %}

                {% endif %}


            </div>

            <!-- Add Watchlist -->
            <div class="cart">
                {% if listing.user.id == request.user.id %}
                    {% if not listing.is_closed %}
                    <form action="{% url 'listing' listing.id %}" method="post">
                        {% csrf_token %}
                        <input type="submit" name="close_listing" value="Close Listing">
                    </form>
                    {% endif %} 
            
                {% else %}
                    {% if user in non_watchers %}
                        <form action="{% url 'listing' listing.id %}" method="post">
                            {% csrf_token %}
                            <i class="fas fa-eye"><input class="watch" type="submit" name="add_watchlist" value="Add Watchlist"></i>
                        </form>
                    {% else %}
                        <form action="{% url 'listing' listing.id %}" method="post">
                            {% csrf_token %}
                            <i class="fas fa-eye-slash"><input class="watch" type="submit" name="remove_watchlist" value="Remove Watchlist"></i>
                        </form>
                    {% endif %}
                {% endif %}

            </div>

        </div>


    </div>
</div>





<h2>Bids:</h2>
<ul>
    {% for bid in listing_bids %}
        <li>

            <a href="{% url 'user_page' bid.user.username %}">
                {{ bid.user.username }}
            </a>
            offered $
                {{ bid.bid }}




        </li>

    {% empty %}
        <li>No bids yet.</li>
    {% endfor %}
</ul>


<h2>Comments:</h2>
<ul>
{% for comment in comments %}

    <li>{{ comment.user.username }} commented: </li>

    <ul>
        <li>{{ comment.comment }}</li>

    </ul>

    {% empty %}
    <li>No comments yet!</li>
{% endfor %}

</ul>
<form action="{% url 'listing' listing.id %}" method="post">
    {% csrf_token %}
    <input type="text" name="new_comment" placeholder="Comment here">
</form>

<h2>Related items:</h2>

{% endblock %}
